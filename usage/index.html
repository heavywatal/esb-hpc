<!doctype html>
<html lang="ja">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">
<title>Usage - Metal — HPC cluster of ESB, SOKENDAI</title>
<link rel="stylesheet" href="/restricted_access/esb-hpc/css/theme.css">
<link rel="apple-touch-icon" sizes="180x180" href="/restricted_access/esb-hpc/apple-touch-icon.png">
<link rel="icon" type="image/png" href="/restricted_access/esb-hpc/favicon-32x32.png" sizes="32x32">
<link rel="manifest" href="/restricted_access/esb-hpc/manifest.json">
<link rel="mask-icon" href="/restricted_access/esb-hpc/safari-pinned-tab.svg" color="#1a4694">
<meta name="theme-color" content="#1a4694">
<meta name="author" content="Watal M. Iwasaki">
<meta property="og:title" content="Usage">
<meta property="og:type" content="article">
<meta property="og:url" content="http://localhost/restricted_access/esb-hpc/usage/">
<meta property="og:image" content="">
<meta property="og:description" content="">
<meta property="og:site_name" content="Metal — HPC cluster of ESB, SOKENDAI">
<meta name="twitter:card" content="summary">
<meta name="twitter:site" content="">
<meta name="twitter:creator" content="">
<meta name="generator" content="Hugo 0.41-DEV" />
<script type="text/x-mathjax-config">
MathJax.Hub.Config({
  showProcessingMessages: false,
  messageStyle: "none",
  displayAlign: "left",
  displayIndent: "2em",
  tex2jax: {
    inlineMath: [['$','$']],
    displayMath: [['\\[', '\\]']]
  }
});
</script>
<script async src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.4/MathJax.js?config=TeX-AMS_CHTML"></script>

<script src="https://use.fontawesome.com/releases/v5.0.10/js/brands.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.10/js/solid.js"></script>
<script src="https://use.fontawesome.com/releases/v5.0.10/js/fontawesome.js"></script>

</head>
<body>
<header><h1><a href="/restricted_access/esb-hpc/">
<img class="logo" src="/restricted_access/esb-hpc/android-chrome-192x192.png" alt="android-chrome-192x192.png">
Metal — HPC cluster of ESB, SOKENDAI
</a></h1>
</header>

<main>
<article>
<header><h1><a href="/restricted_access/esb-hpc/usage/">
Usage
</a></h1>
<nav class="tags"><ul>
</ul></nav>
</header>

<h2 id="getting-started">Getting Started</h2>

<ol>
<li><a href="/restricted_access/esb-hpc/usage/#how-to-setup-ssh-keys">Prepare an SSH key pair on your local computer</a>.</li>
<li>Complete <a href="https://goo.gl/forms/kxe6AWalGjH4wg5t2">the online registration form</a>.</li>
<li>Accept the invitation to <a href="https://groups.google.com/forum/#!forum/metal-sokendai">the user mailing list</a>.</li>
<li>Login to the server: <code>ssh &lt;USERNAME&gt;@metal.campus.soken.ac.jp</code></li>
</ol>

<p></p>

<h2 id="notes">Notes</h2>

<ul>
<li>The server is accessible <strong>only from the ESB campus LAN</strong>.</li>
<li>No graphical user interface (GUI) is available;
all the operation has to be carried out with a <strong>command-line interface (CLI)</strong>.</li>
<li>It is recommended to use
<a href="https://www.google.co.jp/search?q=rsync+ssh"><strong>rsync</strong></a>
to transfer your files between your local computer and the server.</li>
<li>Your home directory <code>~/</code> on the head node is shared with the compute nodes.
You don&rsquo;t have to care about data transfer between nodes within the system.</li>
<li><strong>100GB</strong> disk space is allocated for each user.
The size may be changed in the future.</li>
<li><strong>Do NOT execute programs directly on the head node</strong>.
All the computational tasks must be managed by the PBS job scheduler
<a href="#pbs-job-scheduler">(see below)</a>.</li>
<li>Check <a href="/restricted_access/esb-hpc/software/">the list of available softwares</a>.
You can install additional softwares into your home directory,
or ask the administrator for system-wide installation.</li>
</ul>

<h2 id="how-to-setup-ssh-keys">How to setup SSH keys</h2>

<ol>
<li><p>Execute the following command on your local computer:</p>

<pre><code>% ssh-keygen -t ed25519 -N ''
</code></pre>

<p>Press <kbd>return</kbd> to accept the default name of the key file:</p>

<pre><code>Generating public/private ed25519 key pair.
Enter file in which to save the key (~/.ssh/id_ed25519): # return
Your identification has been saved in ~/.ssh/id_ed25519.
Your public key has been saved in ~/.ssh/id_ed25519.pub.
</code></pre></li>

<li><p>Check the created keys:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">% ls -al ~/.ssh
drwx------ <span class="m">11</span> winston staff <span class="m">374</span> Apr <span class="m">04</span> <span class="m">10</span>:00 ./
-rw-------  <span class="m">1</span> winston staff <span class="m">399</span> Apr <span class="m">04</span> <span class="m">10</span>:00 id_ed25519
-rw-r--r--  <span class="m">1</span> winston staff  <span class="m">92</span> Apr <span class="m">04</span> <span class="m">10</span>:00 id_ed25519.pub</code></pre></div>
<p>The permissions of <code>~/.ssh</code> and <code>~/.ssh/id_ed25519</code> must be <code>700</code> and <code>600</code>, respectively.</p></li>

<li><p>Copy and paste the whole content of the public key (<strong>NOT</strong> private key) to the online registration form.
For example, <code>pbcopy</code> command is useful on macOS:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">% cat ~/.ssh/id_ed25519.pub <span class="p">|</span> pbcopy</code></pre></div></li>

<li><p>After the administrator adds your public key to your <code>~/.ssh/authorized_keys</code> on the server,
you can login from the local computer with the private key <code>~/.ssh/id_ed25519</code>.</p>

<pre><code>% ssh your_username_on_metal@metal.campus.soken.ac.jp
</code></pre></li>

<li><p>(Optional) Create <code>~/.ssh/config</code> on your local computer:</p>

<pre><code>Host metal
  Hostname metal.campus.soken.ac.jp
  User your_username_on_metal
</code></pre>

<p>Then you can login with the shorter command: <code>ssh metal</code>.</p></li>
</ol>

<h2 id="pbs-job-scheduler">PBS job scheduler</h2>

<p><a href="https://www.google.co.jp/search?q=pbs+professional+14">Documentation</a></p>

<h3 id="check-ths-system-status">Check ths system status</h3>

<pre><code>% pbsnodes -aSj
</code></pre>

<h3 id="qsub-submit-a-job"><code>qsub</code>: Submit a job</h3>

<p>You can submit a job from command line or by using scripts:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">% qsub -S /bin/sh -N jobname -- /path/to/your/executable <span class="o">[</span>args...<span class="o">]</span>
    <span class="c1"># or
</span><span class="c1"></span>% qsub hello.sh</code></pre></div>
<p>An example job script <code>hello.sh</code>:</p>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh"><span class="cp">#!/bin/sh
</span><span class="cp"></span><span class="c1">#PBS -S /bin/sh
</span><span class="c1">#PBS -N hello-world
</span><span class="c1">#PBS -l select=1:ncpus=4:mem=2gb
</span><span class="c1"></span>
<span class="nb">pwd</span>
<span class="nb">cd</span> <span class="nv">$PBS_O_WORKDIR</span>
<span class="nb">pwd</span>
<span class="nb">echo</span> <span class="s2">&#34;Hello, world!&#34;</span>
sleep <span class="m">600</span></code></pre></div>
<p>Useful options and environment variables:</p>

<dl>
<dt><code>-l ***</code></dt>
<dd>to request resources.</dd>
<dt><code>-N job_name</code></dt>
<dd>to set job&rsquo;s name.</dd>
<dt><code>-J 1-n</code></dt>
<dd>to declare the job is an array job with size <code>n</code>.</dd>
<dt><code>-v VARIABLE=value</code></dt>
<dd>to export environment variables to the job.</dd>
<dt><code>-o ***</code>, <code>-e ***</code></dt>
<dd>to specify the path for the standard output/error stream.
By default, they are writen to the current working directory where <code>qsub</code> was executed,
i.e., <code>${PBS_O_WORKDIR}/${PBS_JOBNAME}.o&lt;sequence_number&gt;</code></dd>
<dt><code>PBS_JOBID</code></dt>
<dd>the ID of the job.</dd>
<dt><code>PBS_JOBNAME</code></dt>
<dd>the name of the job.</dd>
<dt><code>PBS_O_WORKDIR</code></dt>
<dd>the working directory where <code>qsub</code> was executed.</dd>
</dl>

<p>See <code>man qsub</code> for more details.</p>

<h3 id="qstat-check-the-status-of-jobs"><code>qstat</code>: Check the status of jobs</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">% qstat</code></pre></div>
<h3 id="qdel-delete-a-job"><code>qdel</code>: Delete a job</h3>
<div class="highlight"><pre class="chroma"><code class="language-sh" data-lang="sh">% qdel <span class="m">9</span></code></pre></div>
</article>
</main>

<nav class="menu">

<div><a href="/restricted_access/esb-hpc/">Home</a></div>

<div class="active"><a href="/restricted_access/esb-hpc/usage/">Usage</a></div>

<div><a href="/restricted_access/esb-hpc/hardware/">Hardware</a></div>

<div><a href="/restricted_access/esb-hpc/software/">Software</a></div>
</nav>

<footer><small></small></footer>
</body>
</html>

